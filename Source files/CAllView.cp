// =================================================================================//	CBigView.cp  					©1995-1998 Metrowerks Inc. All rights reserved.// =================================================================================#include <UDrawingState.h>#include <LString.h>#include <math.h>#include "SpikeConstants.h"#include "CSettingsWindow.h"//#include "CProjector.h"#include "CAllView.h"#include "CSpike6App.h"Float64 CAllView::sxmin=0;Float64 CAllView::symin=0;Float64 CAllView::sxmax=0;Float64 CAllView::symax=0;Float64 CAllView::sxscale=0;Float64 CAllView::syscale=0;SInt32 CAllView::sxwindmin=0;SInt32 CAllView::sywindmin=0;SInt32 CAllView::sxwindmax=0;SInt32 CAllView::sywindmax=0;// ---------------------------------------------------------------------------------//		¥ CAllView// ---------------------------------------------------------------------------------CAllView::CAllView(){;}// ---------------------------------------------------------------------------------//		¥ CAllView(SPaneInfo&, SViewInfo&)// ---------------------------------------------------------------------------------CAllView::CAllView(	const SPaneInfo	&inPaneInfo,	const SViewInfo &inViewInfo )		: LView( inPaneInfo, inViewInfo ){;}// ---------------------------------------------------------------------------------//		¥ CAllView(const CAllView&)// ---------------------------------------------------------------------------------CAllView::CAllView(	const CAllView	&inOriginal )		: LView( inOriginal ){;}// ---------------------------------------------------------------------------------//		¥ CAllView(LStream*)// ---------------------------------------------------------------------------------CAllView::CAllView(	LStream	*inStream )		: LView( inStream ){;}// ---------------------------------------------------------------------------------//		¥ ~CAllView// ---------------------------------------------------------------------------------CAllView::~CAllView(){}// ---------------------------------------------------------------------------------//		¥ DrawSelf// ---------------------------------------------------------------------------------voidCAllView::DrawSelf(){if (CSpike6App::tRecord==nil){return;}// Set the font and size.TextFont( kFontIDGeneva );TextSize( 9 );SInt32 xwindmax,xwindmin,ywindmax,ywindmin;SInt32 j,lastspike,hpos,vpos,xoffset,yoffset;Float64 yscale, xscale, xx;Rect theFrame;CalcLocalFrameRect( theFrame );::EraseRect(&theFrame);//set min and max. The .BIN file has -maxint as minimum and +maxint as maximum//the time axis starts at 1 and ends at 64mYmin=-32767;//mYmin=CSpike6App::sMaxMin;mYmax=32768;//mYmax=CSpike6App::sMaxPlus;StColorPenState::Normalize();		// Draw in black and whiteCalcLocalFrameRect(theFrame);::FrameRect(&theFrame);xwindmax = theFrame.right-5;xoffset=5;yoffset=5;xwindmin = theFrame.left+xoffset;ywindmin = theFrame.bottom-yoffset;ywindmax = theFrame.top+yoffset;lastspike = CSpike6App::tRecord->GetCount();mXmin=CSpike6App::SpikeParams.strt;mXmax=CSpike6App::SpikeParams.stp;//get the binfile data//FindOccurrences i.e. locations of spikesCSpike6App::templrecrd theTRec;Float64 ttime;SInt32 tnum,amplitude;xx=1;xscale=(xwindmax-xwindmin)/(mXmax-mXmin);yscale=0.001;for (j=1;j<=lastspike;j++)	{	CSpike6App::tRecord->FetchItemAt(j,&theTRec);	ttime=theTRec.timestamp;	hpos=xwindmin+xscale*(ttime-mXmin);	tnum=theTRec.templatenum;	amplitude=theTRec.plusval-theTRec.minval;   	vpos=-yscale*round(amplitude/2)+36;   	::MoveTo (hpos,vpos);   	vpos=yscale*round(amplitude/2)+36;   	::LineTo (hpos,vpos);    }sxmin=mXmin;symin=mYmin;sxmax=mXmax;symax=mYmax;sxscale=xscale;syscale=yscale;sxwindmin=xwindmin;sywindmin=ywindmin;sxwindmax=xwindmax;sywindmax=ywindmax;}